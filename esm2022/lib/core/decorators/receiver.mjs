import { ɵensureStoreMetadata } from '@ngxs/store/internals';
import { RECEIVER_META_KEY } from '../internal/internals';
function generateHash() {
    return (Math.random() * Date.now()).toString(36).slice(0, 8);
}
function getActionProperties(options, target, key) {
    const defaultProperties = {
        type: `[ID:${generateHash()}] ${target.name}.${key}`,
        payload: undefined,
        action: undefined,
        cancelUncompleted: true
    };
    if (options == null) {
        return defaultProperties;
    }
    const { type, payload, action, cancelUncompleted } = options;
    if (type) {
        defaultProperties.type = type;
    }
    if (payload) {
        defaultProperties.payload = payload;
    }
    if (action) {
        defaultProperties.action = action;
        if (!Array.isArray(action)) {
            defaultProperties.type = action.type;
        }
    }
    if (typeof cancelUncompleted === 'boolean') {
        defaultProperties.cancelUncompleted = cancelUncompleted;
    }
    return defaultProperties;
}
const NG_DEV_MODE = typeof ngDevMode === 'undefined' || ngDevMode;
export function Receiver(options) {
    return (target, key, descriptor) => {
        if (NG_DEV_MODE) {
            const isNotFunctionOrNotStatic = target.prototype == null || descriptor == null || typeof target[key] !== 'function';
            if (isNotFunctionOrNotStatic) {
                throw new TypeError(`Only static functions can be decorated with @Receiver() decorator`);
            }
            const reservedKeyAlreadyExists = key in target.prototype;
            if (reservedKeyAlreadyExists) {
                throw new Error(`Property with name \`${key.toString()}\` already exists, please rename to avoid conflicts`);
            }
        }
        if (typeof key !== 'string') {
            key = String(key);
        }
        const meta = ɵensureStoreMetadata(target);
        const { type, payload, action, cancelUncompleted } = getActionProperties(options, target, key);
        if (NG_DEV_MODE && Object.prototype.hasOwnProperty.call(meta.actions, type)) {
            throw new Error(`Method decorated with such type \`${type}\` already exists`);
        }
        if (Array.isArray(action)) {
            for (const { type } of action) {
                meta.actions[type] = [
                    {
                        fn: `${key}`,
                        options: { cancelUncompleted },
                        type
                    }
                ];
            }
        }
        else {
            meta.actions[type] = [
                {
                    fn: `${key}`,
                    options: { cancelUncompleted },
                    type
                }
            ];
        }
        descriptor.value[RECEIVER_META_KEY] = {
            type,
            action,
            payload
        };
        target.prototype[key] = function (ctx, action) {
            return target[key].call(target, ctx, action);
        };
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjZWl2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2VtaXR0ZXIvc3JjL2xpYi9jb3JlL2RlY29yYXRvcnMvcmVjZWl2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFvQixNQUFNLHVCQUF1QixDQUFDO0FBSTVFLFNBQVMsWUFBWTtJQUNuQixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUMxQixPQUE4QyxFQUM5QyxNQUFnQixFQUNoQixHQUFXO0lBRVgsTUFBTSxpQkFBaUIsR0FBcUI7UUFDMUMsSUFBSSxFQUFFLE9BQU8sWUFBWSxFQUFFLEtBQUssTUFBTSxDQUFDLElBQUksSUFBSSxHQUFHLEVBQUU7UUFDcEQsT0FBTyxFQUFFLFNBQVM7UUFDbEIsTUFBTSxFQUFFLFNBQVU7UUFDbEIsaUJBQWlCLEVBQUUsSUFBSTtLQUN4QixDQUFDO0lBRUYsSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFLENBQUM7UUFDcEIsT0FBTyxpQkFBaUIsQ0FBQztJQUMzQixDQUFDO0lBRUQsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLEdBQUcsT0FBTyxDQUFDO0lBRTdELElBQUksSUFBSSxFQUFFLENBQUM7UUFDVCxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ1osaUJBQWlCLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN0QyxDQUFDO0lBRUQsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNYLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFFbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUMzQixpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN2QyxDQUFDO0lBQ0gsQ0FBQztJQUVELElBQUksT0FBTyxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUMzQyxpQkFBaUIsQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztJQUMxRCxDQUFDO0lBRUQsT0FBTyxpQkFBaUIsQ0FBQztBQUMzQixDQUFDO0FBRUQsTUFBTSxXQUFXLEdBQUcsT0FBTyxTQUFTLEtBQUssV0FBVyxJQUFJLFNBQVMsQ0FBQztBQUVsRSxNQUFNLFVBQVUsUUFBUSxDQUFDLE9BQW1DO0lBQzFELE9BQU8sQ0FBSSxNQUFXLEVBQUUsR0FBb0IsRUFBRSxVQUFzQyxFQUFFLEVBQUU7UUFDdEYsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNoQixNQUFNLHdCQUF3QixHQUM1QixNQUFNLENBQUMsU0FBUyxJQUFJLElBQUksSUFBSSxVQUFVLElBQUksSUFBSSxJQUFJLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFVBQVUsQ0FBQztZQUV0RixJQUFJLHdCQUF3QixFQUFFLENBQUM7Z0JBQzdCLE1BQU0sSUFBSSxTQUFTLENBQUMsbUVBQW1FLENBQUMsQ0FBQztZQUMzRixDQUFDO1lBRUQsTUFBTSx3QkFBd0IsR0FBRyxHQUFHLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQztZQUN6RCxJQUFJLHdCQUF3QixFQUFFLENBQUM7Z0JBQzdCLE1BQU0sSUFBSSxLQUFLLENBQ2Isd0JBQXdCLEdBQUcsQ0FBQyxRQUFRLEVBQUUscURBQXFELENBQzVGLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDNUIsR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQixDQUFDO1FBRUQsTUFBTSxJQUFJLEdBQUcsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUMsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLEdBQUcsbUJBQW1CLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUUvRixJQUFJLFdBQVcsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQzVFLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLElBQUksbUJBQW1CLENBQUMsQ0FBQztRQUNoRixDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDMUIsS0FBSyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUc7b0JBQ25CO3dCQUNFLEVBQUUsRUFBRSxHQUFHLEdBQUcsRUFBRTt3QkFDWixPQUFPLEVBQUUsRUFBRSxpQkFBaUIsRUFBRTt3QkFDOUIsSUFBSTtxQkFDTDtpQkFDRixDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRztnQkFDbkI7b0JBQ0UsRUFBRSxFQUFFLEdBQUcsR0FBRyxFQUFFO29CQUNaLE9BQU8sRUFBRSxFQUFFLGlCQUFpQixFQUFFO29CQUM5QixJQUFJO2lCQUNMO2FBQ0YsQ0FBQztRQUNKLENBQUM7UUFFQSxVQUFVLENBQUMsS0FBYSxDQUFDLGlCQUFpQixDQUFDLEdBQUc7WUFDN0MsSUFBSTtZQUNKLE1BQU07WUFDTixPQUFPO1NBQ1IsQ0FBQztRQUVGLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxHQUFzQixFQUFFLE1BQVc7WUFDbkUsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YXRlQ29udGV4dCB9IGZyb20gJ0BuZ3hzL3N0b3JlJztcclxuaW1wb3J0IHsgybVlbnN1cmVTdG9yZU1ldGFkYXRhIH0gZnJvbSAnQG5neHMvc3RvcmUvaW50ZXJuYWxzJztcclxuXHJcbmltcG9ydCB7IFJFQ0VJVkVSX01FVEFfS0VZLCBSZWNlaXZlck1ldGFEYXRhIH0gZnJvbSAnLi4vaW50ZXJuYWwvaW50ZXJuYWxzJztcclxuXHJcbmRlY2xhcmUgY29uc3QgbmdEZXZNb2RlOiBib29sZWFuO1xyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVIYXNoKCk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIChNYXRoLnJhbmRvbSgpICogRGF0ZS5ub3coKSkudG9TdHJpbmcoMzYpLnNsaWNlKDAsIDgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRBY3Rpb25Qcm9wZXJ0aWVzKFxyXG4gIG9wdGlvbnM6IFBhcnRpYWw8UmVjZWl2ZXJNZXRhRGF0YT4gfCB1bmRlZmluZWQsXHJcbiAgdGFyZ2V0OiBGdW5jdGlvbixcclxuICBrZXk6IHN0cmluZ1xyXG4pIHtcclxuICBjb25zdCBkZWZhdWx0UHJvcGVydGllczogUmVjZWl2ZXJNZXRhRGF0YSA9IHtcclxuICAgIHR5cGU6IGBbSUQ6JHtnZW5lcmF0ZUhhc2goKX1dICR7dGFyZ2V0Lm5hbWV9LiR7a2V5fWAsXHJcbiAgICBwYXlsb2FkOiB1bmRlZmluZWQsXHJcbiAgICBhY3Rpb246IHVuZGVmaW5lZCEsXHJcbiAgICBjYW5jZWxVbmNvbXBsZXRlZDogdHJ1ZVxyXG4gIH07XHJcblxyXG4gIGlmIChvcHRpb25zID09IG51bGwpIHtcclxuICAgIHJldHVybiBkZWZhdWx0UHJvcGVydGllcztcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgdHlwZSwgcGF5bG9hZCwgYWN0aW9uLCBjYW5jZWxVbmNvbXBsZXRlZCB9ID0gb3B0aW9ucztcclxuXHJcbiAgaWYgKHR5cGUpIHtcclxuICAgIGRlZmF1bHRQcm9wZXJ0aWVzLnR5cGUgPSB0eXBlO1xyXG4gIH1cclxuXHJcbiAgaWYgKHBheWxvYWQpIHtcclxuICAgIGRlZmF1bHRQcm9wZXJ0aWVzLnBheWxvYWQgPSBwYXlsb2FkO1xyXG4gIH1cclxuXHJcbiAgaWYgKGFjdGlvbikge1xyXG4gICAgZGVmYXVsdFByb3BlcnRpZXMuYWN0aW9uID0gYWN0aW9uO1xyXG5cclxuICAgIGlmICghQXJyYXkuaXNBcnJheShhY3Rpb24pKSB7XHJcbiAgICAgIGRlZmF1bHRQcm9wZXJ0aWVzLnR5cGUgPSBhY3Rpb24udHlwZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICh0eXBlb2YgY2FuY2VsVW5jb21wbGV0ZWQgPT09ICdib29sZWFuJykge1xyXG4gICAgZGVmYXVsdFByb3BlcnRpZXMuY2FuY2VsVW5jb21wbGV0ZWQgPSBjYW5jZWxVbmNvbXBsZXRlZDtcclxuICB9XHJcblxyXG4gIHJldHVybiBkZWZhdWx0UHJvcGVydGllcztcclxufVxyXG5cclxuY29uc3QgTkdfREVWX01PREUgPSB0eXBlb2YgbmdEZXZNb2RlID09PSAndW5kZWZpbmVkJyB8fCBuZ0Rldk1vZGU7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gUmVjZWl2ZXIob3B0aW9ucz86IFBhcnRpYWw8UmVjZWl2ZXJNZXRhRGF0YT4pOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gIHJldHVybiA8VD4odGFyZ2V0OiBhbnksIGtleTogc3RyaW5nIHwgc3ltYm9sLCBkZXNjcmlwdG9yOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvcjxUPikgPT4ge1xyXG4gICAgaWYgKE5HX0RFVl9NT0RFKSB7XHJcbiAgICAgIGNvbnN0IGlzTm90RnVuY3Rpb25Pck5vdFN0YXRpYyA9XHJcbiAgICAgICAgdGFyZ2V0LnByb3RvdHlwZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IgPT0gbnVsbCB8fCB0eXBlb2YgdGFyZ2V0W2tleV0gIT09ICdmdW5jdGlvbic7XHJcblxyXG4gICAgICBpZiAoaXNOb3RGdW5jdGlvbk9yTm90U3RhdGljKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgT25seSBzdGF0aWMgZnVuY3Rpb25zIGNhbiBiZSBkZWNvcmF0ZWQgd2l0aCBAUmVjZWl2ZXIoKSBkZWNvcmF0b3JgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVzZXJ2ZWRLZXlBbHJlYWR5RXhpc3RzID0ga2V5IGluIHRhcmdldC5wcm90b3R5cGU7XHJcbiAgICAgIGlmIChyZXNlcnZlZEtleUFscmVhZHlFeGlzdHMpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICBgUHJvcGVydHkgd2l0aCBuYW1lIFxcYCR7a2V5LnRvU3RyaW5nKCl9XFxgIGFscmVhZHkgZXhpc3RzLCBwbGVhc2UgcmVuYW1lIHRvIGF2b2lkIGNvbmZsaWN0c2BcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBrZXkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGtleSA9IFN0cmluZyhrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1ldGEgPSDJtWVuc3VyZVN0b3JlTWV0YWRhdGEodGFyZ2V0KTtcclxuICAgIGNvbnN0IHsgdHlwZSwgcGF5bG9hZCwgYWN0aW9uLCBjYW5jZWxVbmNvbXBsZXRlZCB9ID0gZ2V0QWN0aW9uUHJvcGVydGllcyhvcHRpb25zLCB0YXJnZXQsIGtleSk7XHJcblxyXG4gICAgaWYgKE5HX0RFVl9NT0RFICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtZXRhLmFjdGlvbnMsIHR5cGUpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWV0aG9kIGRlY29yYXRlZCB3aXRoIHN1Y2ggdHlwZSBcXGAke3R5cGV9XFxgIGFscmVhZHkgZXhpc3RzYCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYWN0aW9uKSkge1xyXG4gICAgICBmb3IgKGNvbnN0IHsgdHlwZSB9IG9mIGFjdGlvbikge1xyXG4gICAgICAgIG1ldGEuYWN0aW9uc1t0eXBlXSA9IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgZm46IGAke2tleX1gLFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7IGNhbmNlbFVuY29tcGxldGVkIH0sXHJcbiAgICAgICAgICAgIHR5cGVcclxuICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBtZXRhLmFjdGlvbnNbdHlwZV0gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZm46IGAke2tleX1gLFxyXG4gICAgICAgICAgb3B0aW9uczogeyBjYW5jZWxVbmNvbXBsZXRlZCB9LFxyXG4gICAgICAgICAgdHlwZVxyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuICAgIH1cclxuXHJcbiAgICAoZGVzY3JpcHRvci52YWx1ZSBhcyBhbnkpW1JFQ0VJVkVSX01FVEFfS0VZXSA9IHtcclxuICAgICAgdHlwZSxcclxuICAgICAgYWN0aW9uLFxyXG4gICAgICBwYXlsb2FkXHJcbiAgICB9O1xyXG5cclxuICAgIHRhcmdldC5wcm90b3R5cGVba2V5XSA9IGZ1bmN0aW9uIChjdHg6IFN0YXRlQ29udGV4dDxhbnk+LCBhY3Rpb246IGFueSkge1xyXG4gICAgICByZXR1cm4gdGFyZ2V0W2tleV0uY2FsbCh0YXJnZXQsIGN0eCwgYWN0aW9uKTtcclxuICAgIH07XHJcbiAgfTtcclxufVxyXG4iXX0=